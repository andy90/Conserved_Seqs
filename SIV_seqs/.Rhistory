rm(list = ls())
library(tidyverse)
library(seqinr)
library(Biostrings)
read.fasta(file = "uniprot-simian+immunodeficiency+virus+gene_gag.fasta")
a <- read.fasta(file = "uniprot-simian+immunodeficiency+virus+gene_gag.fasta")
View(a)
str(a)
names(a)
View(a)
View(a)
attr(a, Annot)
attr(a, "Annot")
a <- read.fasta(file = "uniprot-simian+immunodeficiency+virus+gene_gag.fasta", as.string = TRUE)
attr(a, "Annot")
View(a)
a <- read.fasta(file = "uniprot-simian+immunodeficiency+virus+gene_gag.fasta", as.string = TRUE, seqtype = "AA")
attr(a, "Annot")
a[[1]]
attributes(a)
attributes(a[[1]])
attributes(a)$Annot
b <- attributes(a)
View(b)
foreach(ai in a) %do% {
attributes(ai)
}
foreach(ai = 1:length(a)) %do% {
attributes(ai)
}
library(foreach)
foreach(ai = 1:length(a)) %do% {
attributes(ai)
}
foreach(i = 1:length(a)) %do% {
attributes(a[[i]])
}
foreach(i = 1:length(a)) %do% {
attributes(a[[i]])$Annot
}
foreach(i = 1:length(a)) %do% {
b <- attributes(a[[i]])$Annot
isgagpol <- grepl("GN=gag-pol", b)
d <- NULL
if (isgagpol){
d <- i
}
d
}
foreach(i = 1:length(a), .combine = "c") %do% {
b <- attributes(a[[i]])$Annot
isgagpol <- grepl("GN=gag-pol", b)
d <- NULL
if (isgagpol){
d <- i
}
d
}
ind_gag_pol <-
foreach(i = 1:length(a), .combine = "c") %do% {
b <- attributes(a[[i]])$Annot
isgagpol <- grepl("GN=gag-pol", b)
d <- NULL
if (isgagpol){
d <- i
}
d
}
a_final <- a[-ind_gag_pol]
View(a_final)
write.fasta(a_final,file.out = "siv_gag.fasta")
write.fasta(a_final, names = names(a_final), file.out = "siv_gag.fasta")
as.character(a)
achar <- as.character(a_final)
nchar(achar)
nchar(achar) > 500
sum(nchar(achar) > 500)
which(nchar(achar) > 500)
ind_full <- which(nchar(achar) > 500)
a_final <- a_final[ind_full]
View(a_final)
write.fasta(a_final, names = names(a_final), file.out = "siv_gag.fasta")
ind_full <- which( (nchar(achar) > 500 ) & (nchar(achar) < 600))
source('~/Documents/SIV_seqs/read_seqs.R')
source('~/Documents/SIV_seqs/AA_msa.R')
vp_mas <- read.fasta("siv_gag_aligned.fasta", seqtype = "AA", seqonly = TRUE)
View(vp_mas)
vp_mas <- as.character(read.fasta("siv_gag_aligned.fasta", seqtype = "AA", seqonly = TRUE))
gap_percent <- colSums(vp_msa == "-")/nrow(vp_msa)
vp_msa <- as.character(read.fasta("siv_gag_aligned.fasta", seqtype = "AA", seqonly = TRUE))
gap_percent <- colSums(vp_msa == "-")/nrow(vp_msa)
vp_msa <- as.character(read.fasta("siv_gag_aligned.fasta", seqtype = "AA", as.string = FALSE))
vp_msa <- as.character(read.fasta("siv_gag_aligned.fasta", seqtype = "AA", as.string = FALSE, seqonly = TRUE))
vp_msa <- as.character(read.fasta("siv_gag_aligned.fasta",  seqonly = TRUE))
vp_msa <- read.fasta("siv_gag_aligned.fasta")
View(vp_msa)
vp_msa <- as.character(read.fasta("siv_gag_aligned.fasta"))
vp_msa[[1]]
vp_msa <- read.fasta("siv_gag_aligned.fasta",  seqonly = TRUE)
View(vp_msa)
vp_msa <- as.character(read.fasta("siv_gag_aligned.fasta",  seqonly = TRUE))
str_split(vp_msa)
str_split(vp_msa, pattern = "")
do.call(rbind, str_split(vp_msa, pattern = ""))
vp_msa_aligned <- do.call(rbind, str_split(vp_msa, pattern = ""))
View(vp_msa_aligned)
gap_percent <- colSums(vp_msa_aligned == "-")/nrow(vp_msa_aligned)
sum(gap_percent > 0.125) # same criteria used by Ferguson
gap_position <- which(gap_percent > 0.125)
vp_msa_aligned <- vp_msa_aligned[, -gap_position]
vp_msa_aligned[1]
vp_msa_aligned[1,]
str(vp_msa_aligned)
apply(vp_msa_aligned, 2, function(seq){
a_table <- sort(table(seq), decreasing = TRUE)
})
apply(vp_msa_aligned, 2, function(seq){
a_table <- sort(table(seq), decreasing = TRUE)
a_table[1]
})
AAfreq <-
apply(vp_msa_aligned, 2, function(seq){
a_table <- sort(table(seq), decreasing = TRUE)
a_table[1]
})
apply(vp_msa_aligned, 2, function(seq){
a_table <- sort(table(seq), decreasing = TRUE)
names(a_table)
})
AA_mostcommon <-
apply(vp_msa_aligned, 2, function(seq){
a_table <- sort(table(seq), decreasing = TRUE)
names(a_table)[1]
})
AAfreq <-
apply(vp_msa_aligned, 2, function(seq){
a_table <- sort(table(seq), decreasing = TRUE)
a_table[1]/nrow(vp_msa_aligned)
})
AAfreq
ind_conserved <- which(AAfreq > 0.9)
ind_conserved
split(ind_conserved, cumsum(c(1, diff(ind_conserved) != 1)))
ind_conserved_consecutive <- split(ind_conserved, cumsum(c(1, diff(ind_conserved) != 1)))
View(ind_conserved_consecutive)
rm(list = ls())
library(tidyverse)
library(seqinr)
library(foreach)
library(Biostrings)
library(msa)
library(here)
foreach(i = 1:length(ind_conserved_consecutive), .combine = "c") %do% {
length(ind_conserved_consecutive[[i]]) >= 5
}
ind_conserved_consecutive <- split(ind_conserved, cumsum(c(1, diff(ind_conserved) != 1)))
source('~/Documents/SIV_seqs/remove_gaps.R')
ind_consect <-
foreach(i = 1:length(ind_conserved_consecutive), .combine = "c") %do% {
length(ind_conserved_consecutive[[i]]) >= 5
}
ind_consect
ind_conserved_consecutive[ind_consect]
AA_consect <-
foreach(i = 1:length(ind_conserved_consecutive), .combine = "c") %do% {
seq <- NULL
if (length(ind_conserved_consecutive[[i]]) >= 5){
seq <- AA_mostcommon[ind_conserved_consecutive[[i]]]
}
seq
}
AA_consect
AA_consect <-
foreach(i = 1:length(ind_conserved_consecutive), .combine = "c") %do% {
seq <- NULL
if (length(ind_conserved_consecutive[[i]]) >= 5){
seq <- AA_mostcommon[ind_conserved_consecutive[[i]]]
}
list(seq)
}
AA_consect
AA_consect <-
foreach(i = 1:length(ind_conserved_consecutive), .combine = "c") %do% {
seq <- NULL
if (length(ind_conserved_consecutive[[i]]) >= 5){
seq <- AA_mostcommon[ind_conserved_consecutive[[i]]]
names(seq) <- ind_conserved_consecutive[[i]]
}
}
AA_consect
AA_consect <-
foreach(i = 1:length(ind_conserved_consecutive), .combine = "c") %do% {
seq <- NULL
if (length(ind_conserved_consecutive[[i]]) >= 5){
seq <- AA_mostcommon[ind_conserved_consecutive[[i]]]
names(seq) <- ind_conserved_consecutive[[i]]
}
list(seq)
}
AA_consect
AA_consect[sapply(AA_consect, is.null)] <- NULL
AA_consect
saveRDS(AA_consect, file = "siv_gag_conserved")
source('~/Documents/SIV_seqs/remove_gaps.R')
source('~/Documents/SIV_seqs/remove_gaps.R')
AA_consect
